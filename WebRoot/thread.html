<!DOCTYPE html>
<html lang="zh_CN">
<head>
<link rel="stylesheet" href="css/bootstrap.min.css" />
<link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
<link rel="stylesheet" href="css/top.css" />
<script src="js/jquery-1.7.2.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<title>Thread</title>
<script type="text/javascript">
	$(function($) {
		getBlogs(-1);
		$("#viewa").click(function() {
			getBlogs(-1);
		});
		$("#viewc").click(function() {
			getBlogs(-2);
		});
		$("#viewd").click(function() {
			getBlogs(-3);
		});
	});

	function rtc(value) {
		$("#btnc" + value).addClass("disabled");
		$.post("/rtc", {
			id : value
		}, function(data) {
			$("#btnc" + value).removeClass("disabled");
			var c = $("#btnc" + value).attr("class");
			if (c.indexOf("primary") < 0) {
				$("#btnc" + value).addClass("btn-primary");
				$("#btnc" + value).text("已收藏");
			} else {
				$("#btnc" + value).removeClass("btn-primary");
				$("#btnc" + value).text("未收藏");
			}
		});
	}

	function rtd(value) {
		$("#btnd" + value).addClass("disabled");
		$.post("/rtd", {
			id : value
		}, function(data) {
			$("#btnd" + value).removeClass("disabled");
			var c = $("#btnd" + value).attr("class");
			if (c.indexOf("primary") < 0) {
				$("#btnd" + value).addClass("btn-primary");
				$("#btnd" + value).text("已删除");
			} else {
				$("#btnd" + value).removeClass("btn-primary");
				$("#btnd" + value).text("未删除");
			}
		});
	}

	function getBlogs(page) {
		$
				.ajax({
					type : "GET",
					url : "/get88workthread",
					data : "page=" + page,
					dataType : "json",
					cache : false,
					success : function(data) {
						if ($(data).length > 0) {
							$("#here").empty();
							var strHTML = "";
							for ( var i = 0; i < data.length; i++) {
								var btn1 = "<button id='btnc"
										+ $(data).get(i).id
										+ "' onclick='javascript:rtc("
										+ $(data).get(i).id
										+ ");' class='btn btn-mini";
								if ($(data).get(i).collected == 1) {
									btn1 += " btn-primary' type='button'>已收藏</button>";
								} else {
									btn1 += "' type='button'>未收藏</button>";
								}
								var btn2 = "<button id='btnd"
										+ $(data).get(i).id
										+ "' onclick='javascript:rtd("
										+ $(data).get(i).id
										+ ");' class='btn btn-mini";
								if ($(data).get(i).deleted == 1) {
									btn2 += " btn-primary' type='button'>已删除</button>";
								} else {
									btn2 += "' type='button'>未删除</button>";
								}
								strHTML += "<tr><td><a href='http://www.zju88.org/agent/"
										+ $(data).get(i).href
										+ "' target='_blank'>"
										+ $(data).get(i).title
										+ "</td><td>"
										+ ($(data).get(i).createDate.year + 1900)
										+ "-"
										+ ($(data).get(i).createDate.month + 1)
										+ "-"
										+ $(data).get(i).createDate.date
										+ " "
										+ $(data).get(i).createDate.hours
										+ ":"
										+ $(data).get(i).createDate.minutes
										+ "</td><td>"
										+ btn1
										+ "&nbsp"
										+ btn2
										+ "</td></tr>";
							}
							$("#here").html(strHTML);
						}
					}
				});
	}
</script>
</head>

<body data-spy="scroll" data-target=".bs-docs-sidebar">
	<script src="js/top.js"></script>

	<div class="container jump">
		<div class="row">
			<div>
				<button id="viewa" class="btn btn-info" type="button">查看全部</button>
				&nbsp
				<button id="viewc" class="btn btn-info" type="button">只看收藏</button>
				&nbsp
				<button id="viewd" class="btn btn-info" type="button">已删除</button>
			</div>
			<br />
			<table class="table table-bordered table-striped">
				<thead>
					<tr>
						<th>主题</th>
						<th>发表时间</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody id="here">
				</tbody>
			</table>
		</div>
	</div>
</body>
</html>